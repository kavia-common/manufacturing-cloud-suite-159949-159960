{"is_source_file": true, "format": "TypeScript", "description": "This file defines WebSocket connection functions and React hooks to establish real-time data streams for KPIs and scheduler updates, with connection management and data parsing features.", "external_files": ["../utils/storage"], "external_methods": ["getStoredAuth"], "published": ["connectDashboardWS", "useDashboardStream", "connectSchedulerWS", "useSchedulerWS", "KpiSnapshot"], "classes": [], "methods": [{"name": "function buildWsBase(): string { buildWsBase", "description": "Constructs the WebSocket base URL from environment variables or current location.", "scope": "", "scopeKind": ""}, {"name": "export function connectDashboardWS(handlers: WSHandlers): WebSocket { connectDashboardWS", "description": "Creates and opens a WebSocket connection to the dashboard KPI stream with specified event handlers.", "scope": "", "scopeKind": ""}, {"name": "export function useDashboardStream(onSnapshot: any) { useDashboardStream", "description": "React hook to subscribe to KPI snapshots with automatic reconnect and message handling.", "scope": "", "scopeKind": ""}, {"name": "export function connectSchedulerWS(handlers: WSHandlers, boardId: string = 'default'): WebSocket/ connectSchedulerWS", "description": "Creates and opens a WebSocket connection for scheduler updates with specified event handlers.", "scope": "", "scopeKind": ""}, {"name": "export function useSchedulerWS(onMessage: (msg: any) => void, boardId: string = 'default') { useSchedulerWS", "description": "React hook to subscribe to scheduler messages with auto-reconnection support.", "scope": "", "scopeKind": ""}, {"name": "function normalizeSnapshot(raw: any): KpiSnapshot | null { normalizeSnapshot", "description": "Parses raw WebSocket message data into a structured KpiSnapshot object.", "scope": "", "scopeKind": ""}, {"name": "function asNumber(v: any, fallback?: number) { asNumber", "description": "Converts a value to a finite number or returns a fallback.", "scope": "", "scopeKind": ""}], "calls": ["getStoredAuth", "new WebSocket", "JSON.parse", "URLSearchParams", "globalThis.setTimeout", "ws.close"], "search-terms": ["WebSocket", "KPI stream", "dashboard", "scheduler", "React hooks", "reconnection", "normalizeSnapshot", "ws.ts", "manufacturing"], "state": 2, "file_id": 30, "knowledge_revision": 121, "git_revision": "40a72807b56f1cc54cf69ad75adb8e1e60e9f975", "revision_history": [{"79": ""}, {"94": ""}, {"95": ""}, {"100": ""}, {"106": ""}, {"107": ""}, {"112": ""}, {"121": "40a72807b56f1cc54cf69ad75adb8e1e60e9f975"}], "ctags": [{"_type": "tag", "name": "KpiSnapshot", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^export type KpiSnapshot = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "WSHandlers", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^type WSHandlers = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "asNumber", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^function asNumber(v: any, fallback?: number) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "attemptRef", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const attemptRef = React.useRef(0);$/", "language": "TypeScript", "kind": "constant", "scope": "useDashboardStream", "scopeKind": "function"}, {"_type": "tag", "name": "attemptRef", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const attemptRef = React.useRef(0);$/", "language": "TypeScript", "kind": "constant", "scope": "useSchedulerWS", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const base = buildWsBase();$/", "language": "TypeScript", "kind": "constant", "scope": "connectDashboardWS", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const base = buildWsBase();$/", "language": "TypeScript", "kind": "constant", "scope": "connectSchedulerWS", "scopeKind": "function"}, {"_type": "tag", "name": "buildWsBase", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^function buildWsBase(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "connect", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^    const connect = () => {$/", "language": "TypeScript", "kind": "constant", "scope": "useDashboardStream", "scopeKind": "function"}, {"_type": "tag", "name": "connect", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^    const connect = () => {$/", "language": "TypeScript", "kind": "constant", "scope": "useSchedulerWS", "scopeKind": "function"}, {"_type": "tag", "name": "connectDashboardWS", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^export function connectDashboardWS(handlers: WSHandlers): WebSocket {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "connectSchedulerWS", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^export function connectSchedulerWS(handlers: WSHandlers, boardId: string = 'default'): WebSocket/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const data = raw.type && raw.data ? raw.data : raw;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeSnapshot", "scopeKind": "function"}, {"_type": "tag", "name": "loc", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const loc = globalThis.location;$/", "language": "TypeScript", "kind": "constant", "scope": "buildWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^      const msg = JSON.parse(e.data as string);$/", "language": "TypeScript", "kind": "constant", "scope": "connectDashboardWS", "scopeKind": "function"}, {"_type": "tag", "name": "msg", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^      const msg = JSON.parse(e.data as string);$/", "language": "TypeScript", "kind": "constant", "scope": "connectSchedulerWS", "scopeKind": "function"}, {"_type": "tag", "name": "n", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const n = typeof v === 'number' ? v : Number(v);$/", "language": "TypeScript", "kind": "constant", "scope": "asNumber", "scopeKind": "function"}, {"_type": "tag", "name": "normalizeSnapshot", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^function normalizeSnapshot(raw: any): KpiSnapshot | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const path = '\\/ws\\/dashboard';$/", "language": "TypeScript", "kind": "constant", "scope": "connectDashboardWS", "scopeKind": "function"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const path = '\\/ws\\/scheduler';$/", "language": "TypeScript", "kind": "constant", "scope": "connectSchedulerWS", "scopeKind": "function"}, {"_type": "tag", "name": "proto", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const proto = loc.protocol === 'https:' ? 'wss:' : 'ws:';$/", "language": "TypeScript", "kind": "constant", "scope": "buildWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "qs", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const qs = new URLSearchParams();$/", "language": "TypeScript", "kind": "constant", "scope": "connectDashboardWS", "scopeKind": "function"}, {"_type": "tag", "name": "qs", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const qs = new URLSearchParams();$/", "language": "TypeScript", "kind": "constant", "scope": "connectSchedulerWS", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const data = raw.type && raw.data ? raw.data : raw;$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeSnapshot", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const raw = (import.meta as any).env?.VITE_WS_BASE_URL as string | undefined;$/", "language": "TypeScript", "kind": "constant", "scope": "buildWsBase", "scopeKind": "function"}, {"_type": "tag", "name": "stored", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const stored = getStoredAuth();$/", "language": "TypeScript", "kind": "constant", "scope": "connectDashboardWS", "scopeKind": "function"}, {"_type": "tag", "name": "stored", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const stored = getStoredAuth();$/", "language": "TypeScript", "kind": "constant", "scope": "connectSchedulerWS", "scopeKind": "function"}, {"_type": "tag", "name": "tenant", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const tenant = stored?.tenantId || '';$/", "language": "TypeScript", "kind": "constant", "scope": "connectDashboardWS", "scopeKind": "function"}, {"_type": "tag", "name": "tenant", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const tenant = stored?.tenantId || '';$/", "language": "TypeScript", "kind": "constant", "scope": "connectSchedulerWS", "scopeKind": "function"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const token = stored?.token || '';$/", "language": "TypeScript", "kind": "constant", "scope": "connectDashboardWS", "scopeKind": "function"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const token = stored?.token || '';$/", "language": "TypeScript", "kind": "constant", "scope": "connectSchedulerWS", "scopeKind": "function"}, {"_type": "tag", "name": "ts", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const ts = data.ts || data.timestamp || new Date().toISOString();$/", "language": "TypeScript", "kind": "constant", "scope": "normalizeSnapshot", "scopeKind": "function"}, {"_type": "tag", "name": "useDashboardStream", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^export function useDashboardStream(onSnapshot: any) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "useSchedulerWS", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^export function useSchedulerWS(onMessage: (msg: any) => void, boardId: string = 'default') {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "v", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const n = typeof v === 'number' ? v : Number(v);$/", "language": "TypeScript", "kind": "constant", "scope": "asNumber", "scopeKind": "function"}, {"_type": "tag", "name": "ws", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const ws = new WebSocket(`${base}${path}?${qs.toString()}`);$/", "language": "TypeScript", "kind": "constant", "scope": "connectDashboardWS", "scopeKind": "function"}, {"_type": "tag", "name": "ws", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const ws = new WebSocket(`${base}${path}?${qs.toString()}`);$/", "language": "TypeScript", "kind": "constant", "scope": "connectSchedulerWS", "scopeKind": "function"}, {"_type": "tag", "name": "wsRef", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const wsRef = React.useRef<WebSocket | null>(null);$/", "language": "TypeScript", "kind": "constant", "scope": "useDashboardStream", "scopeKind": "function"}, {"_type": "tag", "name": "wsRef", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/ws.ts", "pattern": "/^  const wsRef = React.useRef<WebSocket | null>(null);$/", "language": "TypeScript", "kind": "constant", "scope": "useSchedulerWS", "scopeKind": "function"}], "hash": "c70f69b4bf679282848e61056f7ad417", "format-version": 4, "code-base-name": "manufacturing_frontend", "filename": "manufacturing_frontend/src/api/ws.ts"}