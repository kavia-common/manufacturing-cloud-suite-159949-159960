{"is_source_file": true, "format": "TypeScript", "description": "This file implements a lightweight API client using fetch API for a frontend application. It manages JSON requests, authorization headers with Bearer tokens, multi-tenant headers, and includes mechanisms for handling unauthorized responses and error propagation.", "external_files": ["../types/auth", "../utils/storage"], "external_methods": ["getStoredAuth"], "published": ["setUnauthorizedHandler", "apiGet", "apiPost", "loginApi", "logoutApi", "meApi"], "classes": [], "methods": [{"name": "export function setUnauthorizedHandler(handler: UnauthorizedHandler) { setUnauthorizedHandler", "description": "Registers a callback to be invoked on 401 Unauthorized responses.", "scope": "", "scopeKind": ""}, {"name": "export async function apiGet<T = unknown>(path: string, headers?: Record<string, string>): Promi/ apiGet", "description": "Performs an authenticated GET request to the API.", "scope": "", "scopeKind": ""}, {"name": "export async function apiPost<T = unknown>( apiPost", "description": "Performs a POST request, optionally including a body and headers.", "scope": "", "scopeKind": ""}, {"name": "export async function loginApi(username: string, password: string, tenantId?: string): Promise<A/ loginApi", "description": "Executes login against the backend to obtain a JWT token with provided credentials.", "scope": "", "scopeKind": ""}, {"name": "export async function logoutApi(): Promise<{ status: string } | null> { logoutApi", "description": "Attempts to log out on the backend, ignoring errors if the endpoint is unavailable.", "scope": "", "scopeKind": ""}, {"name": "export async function meApi(): Promise<MeResponse> { meApi", "description": "Fetches current authenticated user information, with fallback endpoints.", "scope": "", "scopeKind": ""}, {"name": "async function baseFetch<T = unknown>(path: string, options: ApiOptions = {}): Promise<T> { baseFetch", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async function handleJson(res: Response) { handleJson", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["getStoredAuth", "globalThis.fetch", "JSON.parse", "JSON.stringify", "onUnauthorized", "handleJson", "baseFetch", "apiPost", "apiGet"], "search-terms": ["API client", "fetch wrapper", "authorization header", "multi-tenant header", "bearer token", "login", "logout", "user info"], "state": 2, "file_id": 21, "knowledge_revision": 69, "git_revision": "", "revision_history": [{"48": ""}, {"66": ""}, {"69": ""}], "ctags": [{"_type": "tag", "name": "API_BASE", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^const API_BASE = (import.meta as any).env?.VITE_API_BASE_URL || '';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ApiOptions", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^type ApiOptions = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "UnauthorizedHandler", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^type UnauthorizedHandler = () => void;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "apiGet", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function apiGet<T = unknown>(path: string, headers?: Record<string, string>): Promi/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "apiPost", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function apiPost<T = unknown>($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "baseFetch", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^async function baseFetch<T = unknown>(path: string, options: ApiOptions = {}): Promise<T> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "errData", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^    const errData = await handleJson(response);$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "error", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^    const error = new Error(message) as Error & { status?: number; data?: any };$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "finalHeaders", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const finalHeaders: Record<string, string> = {$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "handleJson", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^async function handleJson(res: Response) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const headers: Record<string, string> = {};$/", "language": "TypeScript", "kind": "constant", "scope": "loginApi", "scopeKind": "function"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const { method = 'GET', body, headers = {}, auth = true } = options;$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "loginApi", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function loginApi(username: string, password: string, tenantId?: string): Promise<A/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "logoutApi", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function logoutApi(): Promise<{ status: string } | null> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "meApi", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function meApi(): Promise<MeResponse> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^    const message =$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "method", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const { method = 'GET', body, headers = {}, auth = true } = options;$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "onUnauthorized", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^let onUnauthorized: UnauthorizedHandler | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "response", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const response = await globalThis.fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "setUnauthorizedHandler", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export function setUnauthorizedHandler(handler: UnauthorizedHandler) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "stored", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const stored = getStoredAuth();$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const text = await res.text();$/", "language": "TypeScript", "kind": "constant", "scope": "handleJson", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const url = path.startsWith('http') ? path : `${API_BASE}${path}`;$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}], "hash": "d66ac9b6c1eea41b9af58c8d7eb79ba1", "format-version": 4, "code-base-name": "manufacturing_frontend", "filename": "manufacturing_frontend/src/api/client.ts", "fields": [{"name": "let onUnauthorized: UnauthorizedHandler | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}]}