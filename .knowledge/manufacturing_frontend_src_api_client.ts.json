{"is_source_file": true, "format": "TypeScript", "description": "This file implements an API client with functions for making HTTP requests (GET, POST, PUT, PATCH, DELETE), handling authentication tokens, managing unauthorized responses, and downloading files. It abstracts fetch calls with JSON handling, header management, and error processing, specifically for a web application interacting with a backend API.", "external_files": ["../types/auth", "../utils/storage"], "external_methods": ["getStoredAuth"], "published": ["setUnauthorizedHandler", "apiGet", "apiPost", "apiPut", "apiPatch", "apiDelete", "downloadFile", "loginApi", "logoutApi", "meApi"], "classes": [], "methods": [{"name": "export function setUnauthorizedHandler(handler: UnauthorizedHandler) { setUnauthorizedHandler", "description": "Registers a callback to be invoked on 401 Unauthorized responses.", "scope": "", "scopeKind": ""}, {"name": "export async function apiGet<T = unknown>(path: string, headers?: Record<string, string>): Promi/ apiGet", "description": "Performs an authenticated GET request to the specified path.", "scope": "", "scopeKind": ""}, {"name": "export async function apiPost<T = unknown>( apiPost", "description": "Performs an authenticated POST request to the specified path.", "scope": "", "scopeKind": ""}, {"name": "export async function apiPut<T = unknown>(path: string, body?: any, headers?: Record<string, str/ apiPut", "description": "Performs an authenticated PUT request to the specified path.", "scope": "", "scopeKind": ""}, {"name": "export async function apiPatch<T = unknown>(path: string, body?: any, headers?: Record<string, s/ apiPatch", "description": "Performs an authenticated PATCH request to the specified path.", "scope": "", "scopeKind": ""}, {"name": "export async function apiDelete<T = unknown>(path: string, headers?: Record<string, string>): Pr/ apiDelete", "description": "Performs an authenticated DELETE request to the specified path.", "scope": "", "scopeKind": ""}, {"name": "export async function downloadFile( downloadFile", "description": "Downloads a file from an authenticated endpoint and triggers a browser download.", "scope": "", "scopeKind": ""}, {"name": "export async function loginApi(username: string, password: string, tenantId?: string): Promise<A/ loginApi", "description": "Calls the backend login endpoint to exchange credentials for a JWT token.", "scope": "", "scopeKind": ""}, {"name": "export async function logoutApi(): Promise<{ status: string } | null> { logoutApi", "description": "Calls the backend logout endpoint, ignoring errors if unavailable.", "scope": "", "scopeKind": ""}, {"name": "export async function meApi(): Promise<MeResponse> { meApi", "description": "Fetches current authenticated user information.", "scope": "", "scopeKind": ""}, {"name": "async function baseFetch<T = unknown>(path: string, options: ApiOptions = {}): Promise<T> { baseFetch", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function guessFilenameFromResponse(resp: Response): string | null { guessFilenameFromResponse", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async function handleJson(res: Response) { handleJson", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["getStoredAuth", "globalThis.fetch", "handleJson", "URL.createObjectURL", "document.createElement", "document.body.appendChild", "document.body.removeChild"], "search-terms": ["istapiClient", "fetch wrapper", "auth handling", "file download", "API utility", "typescript API", "session management"], "state": 2, "file_id": 21, "knowledge_revision": 140, "git_revision": "65fdcd37d1c72dcb70fb23db7deef8a4c0e2f684", "revision_history": [{"48": ""}, {"66": ""}, {"69": ""}, {"137": "65fdcd37d1c72dcb70fb23db7deef8a4c0e2f684"}, {"140": "65fdcd37d1c72dcb70fb23db7deef8a4c0e2f684"}], "ctags": [{"_type": "tag", "name": "API_BASE", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^const API_BASE = (import.meta as any).env?.VITE_API_BASE_URL || '';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ApiOptions", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^type ApiOptions = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "UnauthorizedHandler", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^type UnauthorizedHandler = () => void;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "a", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const a = document.createElement('a');$/", "language": "TypeScript", "kind": "constant", "scope": "downloadFile", "scopeKind": "function"}, {"_type": "tag", "name": "apiDelete", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function apiDelete<T = unknown>(path: string, headers?: Record<string, string>): Pr/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "apiGet", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function apiGet<T = unknown>(path: string, headers?: Record<string, string>): Promi/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "apiPatch", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function apiPatch<T = unknown>(path: string, body?: any, headers?: Record<string, s/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "apiPost", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function apiPost<T = unknown>($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "apiPut", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function apiPut<T = unknown>(path: string, body?: any, headers?: Record<string, str/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "baseFetch", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^async function baseFetch<T = unknown>(path: string, options: ApiOptions = {}): Promise<T> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "blob", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const blob = await resp.blob();$/", "language": "TypeScript", "kind": "constant", "scope": "downloadFile", "scopeKind": "function"}, {"_type": "tag", "name": "cd", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const cd = resp.headers.get('Content-Disposition') || '';$/", "language": "TypeScript", "kind": "constant", "scope": "guessFilenameFromResponse", "scopeKind": "function"}, {"_type": "tag", "name": "dlName", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const dlName = filename || guessFilenameFromResponse(resp) || 'download';$/", "language": "TypeScript", "kind": "constant", "scope": "downloadFile", "scopeKind": "function"}, {"_type": "tag", "name": "downloadFile", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function downloadFile($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "errData", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^    const errData = await handleJson(response);$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "error", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^    const error = new Error(message) as Error & { status?: number; data?: any };$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "finalHeaders", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const finalHeaders: Record<string, string> = {$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "finalHeaders", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const finalHeaders: Record<string, string> = {$/", "language": "TypeScript", "kind": "constant", "scope": "downloadFile", "scopeKind": "function"}, {"_type": "tag", "name": "guessFilenameFromResponse", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^function guessFilenameFromResponse(resp: Response): string | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "handleJson", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^async function handleJson(res: Response) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const headers: Record<string, string> = {};$/", "language": "TypeScript", "kind": "constant", "scope": "loginApi", "scopeKind": "function"}, {"_type": "tag", "name": "headers", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const { method = 'GET', body, headers = {}, auth = true } = options;$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "i", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const match = \\/filename\\\\*?=([^;]+)\\/i.exec(cd);$/", "language": "TypeScript", "kind": "constant", "scope": "guessFilenameFromResponse", "scopeKind": "function"}, {"_type": "tag", "name": "loginApi", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function loginApi(username: string, password: string, tenantId?: string): Promise<A/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "logoutApi", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function logoutApi(): Promise<{ status: string } | null> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "match", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const match = \\/filename\\\\*?=([^;]+)\\/i.exec(cd);$/", "language": "TypeScript", "kind": "constant", "scope": "guessFilenameFromResponse", "scopeKind": "function"}, {"_type": "tag", "name": "meApi", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export async function meApi(): Promise<MeResponse> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^    const message =$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "method", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const { method = 'GET', body, headers = {}, auth = true } = options;$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "objectUrl", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const objectUrl = URL.createObjectURL(blob);$/", "language": "TypeScript", "kind": "constant", "scope": "downloadFile", "scopeKind": "function"}, {"_type": "tag", "name": "onUnauthorized", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^let onUnauthorized: UnauthorizedHandler | null = null;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "resp", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const resp = await globalThis.fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "downloadFile", "scopeKind": "function"}, {"_type": "tag", "name": "response", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const response = await globalThis.fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "setUnauthorizedHandler", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^export function setUnauthorizedHandler(handler: UnauthorizedHandler) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "stored", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const stored = getStoredAuth();$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "stored", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const stored = getStoredAuth();$/", "language": "TypeScript", "kind": "constant", "scope": "downloadFile", "scopeKind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const text = await res.text();$/", "language": "TypeScript", "kind": "constant", "scope": "handleJson", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const url = path.startsWith('http') ? path : `${API_BASE}${path}`;$/", "language": "TypeScript", "kind": "constant", "scope": "baseFetch", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/manufacturing-cloud-suite-159949-159960/manufacturing_frontend/src/api/client.ts", "pattern": "/^  const url = path.startsWith('http') ? path : `${API_BASE}${path}`;$/", "language": "TypeScript", "kind": "constant", "scope": "downloadFile", "scopeKind": "function"}], "hash": "31dcb190beb174de5d68f91a93dedaf8", "format-version": 4, "code-base-name": "manufacturing_frontend", "filename": "manufacturing_frontend/src/api/client.ts", "fields": [{"name": "let onUnauthorized: UnauthorizedHandler | null = null;", "scope": "", "scopeKind": "", "description": "unavailable"}]}